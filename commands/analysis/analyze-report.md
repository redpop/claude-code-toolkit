---
allowed-tools: Task, Read, Grep, Bash(jq:*), Bash(sort:*), Bash(awk:*), Write
description: Intelligent analysis of code quality reports with trend detection, prioritization, and actionable insights
argument-hint: [report.json] [--compare=other-report.json] [--history] [--trends] [--quick-wins] [--export-md]
---

**IMPORTANT: This command analyzes existing report files. File creation is ONLY allowed for analysis exports when --export flags are used.**

# Report Analysis Command

This command provides intelligent analysis of code quality reports generated by analysis commands like `/analyze-deep`, `/security-audit`, etc. It identifies trends, prioritizes issues, and generates actionable insights.

## Usage Modes

### 1. Single Report Analysis
```bash
/analyze-report report.json                    # Basic analysis
/analyze-report report.json --quick-wins      # Focus on easy fixes
/analyze-report report.json --export-md       # Export analysis
```

### 2. Report Comparison
```bash
/analyze-report current.json --compare=previous.json
/analyze-report report1.json --compare=report2.json --export-md=comparison.md
```

### 3. Historical Trend Analysis
```bash
/analyze-report reports/*.json --trends        # Analyze all reports
/analyze-report --history                      # Use .report-history.json
/analyze-report --history --last=10           # Last 10 reports only
```

### 4. Multi-Project Analysis
```bash
/analyze-report frontend/report.json backend/report.json mobile/report.json
/analyze-report */latest-report.json --export-md=cross-project-analysis.md
```

## Analysis Workflow

### Phase 1: Report Loading and Validation

1. **Load Report(s)**:
   - Parse JSON report file(s)
   - Validate schema compliance
   - Extract metadata and metrics
   - Check report completeness

2. **Normalize Data**:
   - Handle different report versions
   - Standardize metric scales
   - Align severity classifications
   - Process timestamps

### Phase 2: Deep Analysis

Based on the mode and parameters, delegate to the report-analyzer agent:

```markdown
Analyze the following report data:
- Mode: [single/compare/trends/history]
- Focus: [general/quick-wins/critical/trends]
- Reports: [list of reports with metadata]

Provide:
1. Executive summary with key insights
2. Prioritized action items with ROI scores
3. Trend analysis (if multiple reports)
4. Specific recommendations based on findings
```

### Phase 3: Generate Insights

The analyzer will provide:

1. **Health Score Analysis**:
   - Current state assessment
   - Comparison with previous/target
   - Component breakdown
   - Improvement potential

2. **Issue Prioritization**:
   - ROI-based ranking
   - Quick wins identification
   - Dependency analysis
   - Resource optimization

3. **Trend Detection**:
   - Improvement velocity
   - Regression alerts
   - Predictive projections
   - Anomaly detection

4. **Actionable Recommendations**:
   - Immediate actions
   - Sprint planning
   - Long-term strategy
   - Team allocation

### Phase 4: Export Results (if requested)

Generate formatted output:

```markdown
# Code Quality Analysis Report

**Generated**: {timestamp}
**Reports Analyzed**: {count}
**Analysis Type**: {single/comparison/trend}

## Executive Summary
{key_insights}

## Priority Actions
### üî• Immediate (Best ROI)
{high_roi_items}

### ‚ö° Quick Wins (< 4 hours)
{quick_win_items}

## Trend Analysis
{trend_charts_and_insights}

## Detailed Findings
{categorized_analysis}
```

## Advanced Features

### ROI Scoring
```
ROI = (Impact √ó 10) / Effort_Hours
Impact = Severity √ó Scope √ó Business_Value
```

### Quick Win Detection
Identifies issues that:
- Take < 4 hours to fix
- Have medium+ impact
- No complex dependencies
- Clear implementation path

### Anomaly Detection
Flags unusual patterns:
- Sudden metric drops
- Outlier findings
- Regression indicators
- Unexpected improvements

### Velocity Calculation
Tracks improvement speed:
- Issues fixed/week
- Quality score delta/sprint
- Coverage improvement rate
- Time to target estimation

## Command Examples

### Basic Analysis
```bash
# Analyze latest report
/analyze-report analyze-deep-20250128.json

# Focus on quick wins
/analyze-report report.json --quick-wins

# Export analysis
/analyze-report report.json --export-md=analysis.md
```

### Comparison
```bash
# Compare two reports
/analyze-report new.json --compare=old.json

# Compare with percentage changes
/analyze-report current.json --compare=baseline.json --show-deltas
```

### Trend Analysis
```bash
# Analyze all reports in directory
/analyze-report reports/*.json --trends

# Use historical data
/analyze-report --history --trends

# Last 30 days only
/analyze-report --history --days=30 --trends
```

### Team Planning
```bash
# Generate sprint planning data
/analyze-report report.json --sprint-planning

# Estimate fix timeline
/analyze-report report.json --estimate-timeline

# Team allocation suggestions
/analyze-report report.json --team-allocation
```

## Integration Examples

### CI/CD Pipeline
```yaml
- name: Analyze Code Quality
  run: |
    /analyze-deep --export-json=report.json
    /analyze-report report.json --quick-wins --export-md=quick-wins.md
    
    # Fail if quality degraded
    /analyze-report report.json --compare=baseline.json --fail-on-regression
```

### Daily Standup Report
```bash
#!/bin/bash
# Generate daily progress report
/analyze-report --history --last=2 --export-md=daily-progress.md
echo "Progress: $(jq '.improvement_percentage' daily-progress.json)%"
```

### Sprint Planning
```bash
# Generate sprint backlog from quick wins
/analyze-report latest-report.json --quick-wins --export-json=backlog.json

# Create tickets
jq '.quick_wins[]' backlog.json | while read -r issue; do
  create-jira-ticket "$issue"
done
```

## Output Interpretation

### Health Score Trends
- **Improving (üìà)**: Positive delta > 5%
- **Stable (‚û°Ô∏è)**: Delta between -5% and +5%
- **Declining (üìâ)**: Negative delta > 5%

### Priority Levels
- **üî• Critical**: Fix immediately (ROI > 8)
- **‚ö° High**: Next sprint (ROI 5-8)
- **‚ö†Ô∏è Medium**: Plan for quarter (ROI 2-5)
- **üí° Low**: Consider if time permits (ROI < 2)

### Effort Estimates
- **Minutes**: < 1 hour
- **Hours**: 1-8 hours
- **Days**: 1-5 days
- **Weeks**: > 5 days

This command transforms raw analysis data into actionable intelligence, helping teams make data-driven decisions about code quality improvements.